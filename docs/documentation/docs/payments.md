---
id: payments
title: Payments
---

The Checkout.com Payments API provides a unified integration experience for a variety of payment methods. 

You can find a list of request body parameters and possible outcomes [here](https://api-reference.checkout.com/#tag/Payments).

export const Highlight = ({children, color}) => (
<span
style={{
      color: color,
      padding: '0.2rem',
    }}>
{children}
</span>
);

The SDK will infer the `type` of the payment `source`, if not provided, as follows:
- `type: "card"` if `number` attribute present.
- `type: "customer"` if `email` attribute present or `id` attribute present and prefix is `cus_`.
- `type: "token"` if `token` attribute present.
- `type: "id"` if `id` attribute present and prefix is `src_`.

**Important**
- If the `type` is not provided and cannot be inferred, a `ValueError` is thrown.
- All `type` values are accepted in the SDK and validated at API level.
- When using alternative payment methods (APMs), a `type` must be provided. See example below.

## Request a card payment
There are a number of ways to request a card payment, as indicated below.

### Token Source

The card token is generated by on of the Front End integration options like [Checkout.Frames](https://docs.checkout.com/docs/frames) or one of the [Mobile SDKs](https://docs.checkout.com/docs/sdks#section-mobile-sdk-libraries). Keep in mind that this token expires in 15 minutes and it's a single time use token.

``` python
try:
    payment = api.payments.request(
        source={
            'token': 'tok_...'.
            'billing_address': { ... },
            'phone': { ... }
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
    )
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

### Id Source

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">source ID</Highlight>. This id does not expire, so it can be used perform payments without needing the customer to enter the card details again.

``` python
try:
    payment = api.payments.request(
        source={
            'id': 'src_...'
            'cvv': '100'                                # source-related attribute
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
    )
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

### Full Card Details

:::warning

You need to have a high level of PCI Compliance (SAQ-D) to be able to send requests with full card details. Note that unless this payment option is enabled on your account by Checkout.com, the <Highlight color="#5A522C">request will fail</Highlight>. Contact you account manager to request access for this payment interaction.

:::

``` python
try:
    payment = api.payments.request(
        source={
            'number': '4242424242424242',
            'expiry_month': 6,
            'expiry_year': 2025,
            'cvv': '100'
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
    )
    print(payment.id)
    print(payment.is_pending)                           # False
    print(payment.http_response.body)                   # JSON body
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```


### Existing Customer

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">Customer.Id</Highlight>. This id can be used perform payments without needing the customer to enter the card details again.

``` python
try:
    payment = api.payments.request(
        source={
            'id': 'cus_...'
            # or ...
            'email': 'user@checkout.com'
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
    )
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

### Local payment method

The [API Reference](https://api-reference.checkout.com/) contains a list of local payment options that you can use, as well as the other information required in the payment source (if required)

This is an example of a payment request for <Highlight color="#25c2a0">iDeal</Highlight>:

``` python
try:
    payment = api.payments.request(
        source={
            'type': 'ideal',
            'bic': 'INGBNL2A'                     # source-related attribute
            'description': 'test ideal description'
        },
        amount=100,                                     # cents
        currency=sdk.Currency.EUR,                      # or 'eur'
        reference='pay_apm_ref'
    )
    print(payment.is_pending)                           # True
    print(payment.requires_redirect)                    # True
    print(payment.redirect_link.href)                   # APM url
    print(payment.id)
    print(payment.http_response.body)                   # JSON body
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

As you can see from the [API Reference](https://api-reference.checkout.com/) this request is meant to return a redirection URL, so you can let the customer complete the transaction on the local payment's website. Normally a successful response would look like this:

```json
{
    "id": "pay_y3gars76cvrudairph27ekzpvm",
    "status": "Pending",
    "customer": {
        "id": "cus_zbsnutwm2hoevnxnyj6o26sibe"
    },
    "_links": {
        "self": {
            "href": "https://api.sandbox.checkout.com/payments/pay_y3gars76cvrudairph27ekzpvm"
        },
        "redirect": {
            "href": "https://sandbox.checkout.com/LP.Core/api/payment/191952"
        }
    }
}
```

You can access the redirect link in <Highlight color="#25c2a0">payment.redirect_link.href</Highlight>



## 3DS 
### Request a <Highlight color="#25c2a0">3D Secure payment</Highlight>

You have the ability to request 3DS in a payment request. The request body is similar to normal card payments, but with some additional parameters. [Read more about 3DS](https://docs.checkout.com/docs/3d-secure-payments)

``` python
try:
    payment = api.payments.request(
        source={
            'number': '4242424242424242',
            'expiry_month': 6,
            'expiry_year': 2025,
            'cvv': '100'
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
        threeds=True                                    # shortcut for { 'enabled': True }
    )
    print(payment.is_pending)                           # True (always check this flag)
    print(payment.requires_redirect)                    # True
    print(payment.redirect_link.href)                   # ACS url
    print(payment.id)
    print(payment.http_response.body)                   # JSON body
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_code} {0.elapsed} {0.event_id} // {0.message}'.format(e))
```

> **Important**: If you use the Checkout.com Risk Engine to upgrade to a 3DS flow (from N3D) depending on criteria, you must always check for `payment.is_pending` first.

Similar to local payment options, 3D Secure payments will return a redirection URL. Here is an example of a 3DS response:

```json
{
    "id": "pay_krq2q22lblsevfkay2gfyvatta",
    "status": "Pending",
    "customer": {
        "id": "cus_c5c7d5f4avnehbhhgmnkdadkdu"
    },
    "3ds": {
        "downgraded": false,
        "enrolled": "Y"
    },
    "_links": {
        "self": {
            "href": "https://api.sandbox.checkout.com/payments/pay_krq2q22lblsevfkay2gfyvatta"
        },
        "redirect": {
            "href": "https://3ds2-sandbox.ckotech.co/interceptor/3ds_dr6us33uu57utjwh7yl5szcgqy"
        }
    }
}
```
You can access the redirect link in <Highlight color="#25c2a0">payment.redirect_link.href</Highlight>

### Request a 3D Secure payment with N3D Downgrade Option

``` python
try:
    payment = api.payments.request(
        source={
            'number': '4242424242424242',
            'expiry_month': 6,
            'expiry_year': 2025,
            'cvv': '100'
        },
        amount=100,                                     # cents
        currency=sdk.Currency.USD,                      # or 'usd'
        reference='pay_ref'
        threeds={
            'enabled': True,
            'attempt_n3d': True
        }
    )
    print(payment.is_pending)                           # False
    print(payment.3ds.downgraded)                       # True
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_code} {0.elapsed} {0.event_id} // {0.message}'.format(e))
```

> **Important**: Value needs to be set to `5000` to simulate a `20153` response code on the Sandbox environment, which will then attempt an N3D charge.


## Handle card <Highlight color="#25c2a0">payment responses</Highlight>


Assuming the payment request is valid, the Payments API can return one of two responses:

1. Pending (HTTP 202) - Asynchronous payment methods or any that require a redirect such as 3D-Secure payments
2. Successfully Processed (HTTP 201) - Could be approved or declined

### Considering all cases
``` python
if payment.is_pending:
        print("Payment pending...")
        if payment.requires_redirect:
            print("Required Redirection...")
            print("Click here: " + payment.redirect_link.href)
elif payment.http_response.body['approved'] and payment.http_response.body['risk']['flagged']:
    print("Payment Flagged")
elif payment.http_response.body['approved'] and not(payment.http_response.body['risk']['flagged']):
    print("Payment Successful")
else:
    print("Payment Declined") 
```

### API Responses format


All API responses follow this format:

``` python
response = client.do_something(...)
# Request Id and API version
response.request_id
response.api_version
# HTTP response and attributes
response.http_response.status
response.http_response.headers
response.http_response.body                             # JSON body
response.http_response.elapsed
# HATEOAS
response.links
response.self_link
response.has_link(...)                                  # True | False
response.get_link(...)                                  # href and title
```

### Payload Attributes

All attributes are dynamically mounted on the response as both class attributes and dictionary keys. Set the `sdk.default_response_immutable` default to `False` if you wish to be able to add your own attributes.

``` json
{
    "id": "pay",
    "source": {
        "type": "card",
        "number": "4242",
        "billing_address": {
            "city": "London"
        }
    },
    "_links": {
        "self": {
            "href": "http://url"
        }
    },
    "some_array": [
        {
            "key1": "value1"
        }
    ]
}
```

``` python
response = client.do_something(...)
response.id == 'pay'
response['id'] == 'pay'
response.source.type == 'card'
response['source']['type'] == 'card'
response.source.billing_address.city == 'London'
response.some_array[0].key1 == 'value1'
# if `sdk.default_response_immutable` is False
response.custom_attr1 = 'custom attribute 1'
response['custom_attr2'] = 999
```

## Get payment details

### Using Payment ID

``` python
try:
    payment = api.payments.get('pay_...')
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

### Using Session ID

``` python
try:
    payment = api.payments.get('sid_...')
    print(payment.id)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

## Get payment actions

``` python
try:
    actions = api.payments.get_actions('pay_...')
    for action in actions:
        print(action.id)
        print(action.type)
        print(action.response_code)
        print(action.reference)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

## Capture a payment

``` python
try:
    action = api.payments.capture('pay_...', amount=100, reference='CAPTURE')

    print(action.id)
    print(action.get_link('payment').href)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

## Refund a payment

``` python
try:
    action = api.payments.refund('pay_...', amount=100, reference='REFUND')

    print(action.id)
    print(action.get_link('payment').href)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```

## Void a payment

``` python
try:
    action = api.payments.void('pay_...', reference='VOID')

    print(action.id)
    print(action.get_link('payment').href)
except sdk.errors.CheckoutSdkError as e:
    print('{0.http_status} {0.error_type} {0.elapsed} {0.request_id}'.format(e))
```